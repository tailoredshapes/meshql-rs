"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Traits=void 0;var cxapi=()=>{var tmp=require("../../../cx-api/index");return cxapi=()=>tmp,tmp},errors_1=()=>{var tmp=require("../errors");return errors_1=()=>tmp,tmp},feature_flags_1=()=>{var tmp=require("../feature-flags");return feature_flags_1=()=>tmp,tmp};class Traits{sym;defaultFactoryFor;instances=new WeakMap;constructor(sym,defaultFactoryFor){this.sym=sym,this.defaultFactoryFor=defaultFactoryFor}of(resource){const cached=this.instances.get(resource);if(cached!=null)return cached;let factory=this.lookupFactory(resource);if(factory==null){if(!feature_flags_1().FeatureFlags.of(resource).isEnabled(cxapi().AUTOMATIC_L1_TRAITS)){const msg=`Couldn't find trait for ${resource}, install one explicitly or enable the feature flag '${cxapi().AUTOMATIC_L1_TRAITS}'`;throw new(errors_1()).ValidationError(msg,resource)}factory=this.defaultFactoryFor(resource.cfnResourceType)}if(factory!=null){const trait=factory.forResource(resource);return this.instances.set(resource,trait),trait}}register(scope,cfnType,factory,sym){let factoryMap=scope[sym];factoryMap||(factoryMap=new Map,Object.defineProperty(scope,sym,{value:factoryMap,configurable:!1,enumerable:!1})),factoryMap.set(cfnType,factory)}lookupFactory(scope){for(let current=scope;current!=null;current=current.node&&current.node.scope?current.node.scope:void 0){const factoryMap=current[this.sym];if(factoryMap){const factory=factoryMap.get(scope.cfnResourceType);if(factory)return factory}}}}exports.Traits=Traits;
