"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var aws_iam_1=()=>{var tmp=require("../../../aws-iam");return aws_iam_1=()=>tmp,tmp},aws_kms_1=()=>{var tmp=require("../../../aws-kms");return aws_kms_1=()=>tmp,tmp},core_1=()=>{var tmp=require("../../../core");return core_1=()=>tmp,tmp},helpers_internal_1=()=>{var tmp=require("../../../core/lib/helpers-internal");return helpers_internal_1=()=>tmp,tmp},sqs_generated_1=()=>{var tmp=require("../sqs.generated");return sqs_generated_1=()=>tmp,tmp};class QueueWithPolicyFactory{forResource(resource){return ifCfnQueue(resource,r=>new CfnQueueWithPolicy(r))}}class CfnQueueWithPolicy{queue;env;policy;policyDocument;constructor(queue){this.queue=queue,this.env=queue.env}addToResourcePolicy(statement){return this.policy||(this.policy=new(sqs_generated_1()).CfnQueuePolicy(this.queue,"QueuePolicy",{queues:[this.queue.ref],policyDocument:{Statement:[]}})),this.policyDocument||(this.policyDocument=aws_iam_1().PolicyDocument.fromJson(this.policy.policyDocument??{Statement:[]})),this.policyDocument.addStatements(statement),this.policy.policyDocument=this.policyDocument.toJSON(),{statementAdded:!0,policyDependable:this.policy}}}class EncryptedQueueFactory{forResource(resource){return ifCfnQueue(resource,r=>new EncryptedCfnQueue(r))}}class EncryptedCfnQueue{queue;env;constructor(queue){this.queue=queue,this.env=queue.env}grantOnKey(grantee,...actions){const key=tryFindKmsKeyForQueue(this.queue);return{grant:key?aws_kms_1().KeyGrants.fromKey(key).actions(grantee,...actions):void 0}}}function ifCfnQueue(resource,factory){if(!sqs_generated_1().CfnQueue.isCfnQueue(resource))throw new(core_1()).ValidationError(`Construct ${resource.node.path} is not of type CfnQueue`,resource);return factory(resource)}function tryFindKmsKeyForQueue(queue){const kmsMasterKeyId=queue.kmsMasterKeyId;if(kmsMasterKeyId)return(0,helpers_internal_1().findClosestRelatedResource)(queue,"AWS::KMS::Key",(_,key)=>key.ref===kmsMasterKeyId||key.attrKeyId===kmsMasterKeyId||key.attrArn===kmsMasterKeyId)}aws_iam_1().DefaultPolicyFactories.set("AWS::SQS::Queue",new QueueWithPolicyFactory),aws_iam_1().DefaultEncryptedResourceFactories.set("AWS::SQS::Queue",new EncryptedQueueFactory);
